# Simple DTU Pay

Simple DTU Pay is a microservice-based payment system that acts as a broker between customers and merchants. It allows users to register and perform payments, with the actual money transfer being handled by an external SOAP-based bank service.

This project is implemented using **Quarkus**, **Java 21**, and **Cucumber** for BDD testing.

## Features

- **REST API**:
  - `POST /customers`: Register a customer (returns a unique DTU Pay ID).
  - `POST /merchants`: Register a merchant (returns a unique DTU Pay ID).
  - `POST /payments`: Initiate a payment from a customer to a merchant.
  - `GET /payments`: List all executed payments.
- **SOAP Integration**: Connects to the external "FastMoney" bank service for real fund transfers.
- **In-Memory Storage**: Uses concurrent maps to store users and payments (no database required).

## Tech Stack

- **Java 21**
- **Quarkus**: Kubernetes Native Java stack.
- **RESTEasy**: JAX-RS implementation for REST endpoints.
- **JAX-WS**: For SOAP client integration.
- **Cucumber**: For Behavior-Driven Development (BDD) testing.
- **RestAssured**: For API testing.
- **Lombok**: For boilerplate code reduction.

## Prerequisites

- Java 21+ installed.
- Maven 3.9+ (or use the provided `mvnw` wrapper).
- Git.

## How to Run

### 1. Compile and Run in Dev Mode

This will start the application on `http://localhost:8080`.

```bash
./mvnw quarkus:dev
```

### 2. Run Tests

The project includes comprehensive Cucumber tests that verify the full flow:
1. Create bank accounts for customer/merchant via SOAP.
2. Register them in Simple DTU Pay.
3. Execute a payment via REST API.
4. Verify bank balances.
5. Cleanup (delete bank accounts).

**Note:** You must provide a valid **Bank API Key** in `src/test/java/org/acme/simpledtupay/SimpleDTUPaySteps.java` before running tests.

```bash
./mvnw test
```

## Project Structure

```
src/
├── main/java/org/acme/simpledtupay/
│   ├── api/            # JAX-RS Resources (REST Interface)
│   ├── domain/         # Business Logic and Entities
│   └── infrastructure/ # External Service Adapters (SOAP Bank)
└── test/
    ├── java/org/acme/simpledtupay/
    │   ├── SimpleDTUPaySteps.java  # Cucumber Step Definitions
    │   └── SimpleDTUPayClient.java # REST Client for testing
    └── resources/org/acme/simpledtupay/
        └── payment.feature         # Cucumber Scenarios
```

## SOAP Client Generation

The SOAP client stubs (`dtu.ws.fastmoney.*`) are automatically generated by the `jaxws-maven-plugin` during the build process from the WSDL located at:
`http://fm-00.compute.dtu.dk/services/BankService?wsdl`